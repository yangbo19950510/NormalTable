import{JsxRender as e}from"@/components/render";import{COMPONENTS_NAME as n,EVENT_NAME as t}from"@/components/constants.js";import a from"@/components/NormalSelect/index.vue";import i from"@/components/NormalDate/datePicker.vue";import o from"@/components/NormalDate/date.vue";function s(e,n,t,a,i,o,s,r,l,c){"boolean"!=typeof s&&(l=r,r=s,s=!1);const d="function"==typeof t?t.options:t;let m;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,i&&(d.functional=!0)),a&&(d._scopeId=a),o?(m=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=m):n&&(m=s?function(e){n.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){n.call(this,r(e))}),m)if(d.functional){const e=d.render;d.render=function(n,t){return m.call(t),e(n,t)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,m):[m]}return t}const r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function l(e){return(e,n)=>function(e,n){const t=r?n.media||"default":e,a=d[t]||(d[t]={ids:new Set,styles:[]});if(!a.ids.has(e)){a.ids.add(e);let t=n.source;if(n.map&&(t+="\n/*# sourceURL="+n.map.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),a.element||(a.element=document.createElement("style"),a.element.type="text/css",n.media&&a.element.setAttribute("media",n.media),void 0===c&&(c=document.head||document.getElementsByTagName("head")[0]),c.appendChild(a.element)),"styleSheet"in a.element)a.styles.push(t),a.element.styleSheet.cssText=a.styles.filter(Boolean).join("\n");else{const e=a.ids.size-1,n=document.createTextNode(t),i=a.element.childNodes;i[e]&&a.element.removeChild(i[e]),i.length?a.element.insertBefore(n,i[e]):a.element.appendChild(n)}}}(e,n)}let c;const d={};const m={name:"NormalPages"};var p=function(){var e=this,n=e.$createElement;return(e._self._c||n)("el-pagination",e._g(e._b({staticClass:"pagination-container"},"el-pagination",e.$attrs,!1),e.$listeners))};p._withStripped=!0;const u=s({render:p,staticRenderFns:[]},(function(e){e&&e("data-v-61bd8561_0",{source:"\n.pagination-container[data-v-61bd8561] {\n  background: #fff;\n  margin-top: 16px;\n  text-align: right;\n}\n",map:{version:3,sources:["/Users/yangbo/Desktop/yk/NormalTable/src/components/NormalTable/coms/pages.vue"],names:[],mappings:";AAeA;EACA,gBAAA;EACA,gBAAA;EACA,iBAAA;AACA",file:"pages.vue",sourcesContent:['<template>\n  <el-pagination\n    class="pagination-container"\n    v-bind="$attrs"\n    v-on="$listeners"\n  >\n  </el-pagination>\n</template>\n\n<script>\nexport default {\n  name: \'NormalPages\'\n}\n<\/script>\n<style scoped>\n.pagination-container {\n  background: #fff;\n  margin-top: 16px;\n  text-align: right;\n}\n</style>\n']},media:void 0})}),m,"data-v-61bd8561",false,undefined,!1,l,void 0,void 0);const b={name:"NormalSelect",props:{tabs:{type:Object,default:()=>{}},changeTabs:{type:Function,default:()=>{}}},data:()=>({options:[],type:""}),mounted(){this.init()},methods:{async init(){const{list:e,defaultValue:n}=this.tabs,t=e instanceof Function?await e():e,a=new Map([["value","value"],["id","id"]]),i=Object.keys(t?.[0]).find((e=>a.has(e))),o=t?.[0]?.[i],s=n instanceof Function?await n(t):n;this.type=s||0===s?s:o,this.options=t,this.changeTab()},changeTab(){const{type:e,tabs:n,options:t}=this;if(n.changeTab){const a=t?.find((n=>n.id===e||n.value===e))||{};n.changeTab(a)}this.changeTabs(e)}}};var g=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("el-tabs",{on:{"tab-click":e.changeTab},model:{value:e.type,callback:function(n){e.type=n},expression:"type"}},e._l(e.options,(function(e){return t("el-tab-pane",{key:e.id||e.value,attrs:{label:e.label,name:e.id||e.value}})})),1)};g._withStripped=!0;const h=s({render:g,staticRenderFns:[]},undefined,b,undefined,false,undefined,!1,void 0,void 0,void 0);const f={name:"NormalForm",components:{NormalSelect:a,NormalPicker:i,NormalDate:o},props:{tablesFilter:{type:Array,default:()=>[]},operations:{type:Array,default:()=>[]},getList:{type:Function,default:()=>{}}},data:()=>({componentsData:n,searchForm:{}}),computed:{getBindAll:e=>e=>{const{options:n}=e?.bind||{},t="function"==typeof n?n?.():n;return{...t&&{options:t},placeholder:e.label,...e.bind}},getEventsAll:e=>e=>{const n=e?.bind||{},a={};return Object.keys(n).forEach((e=>{t.includes(e)&&(a[e]=n[e])})),a},getBtnBind:e=>e=>e?.bind??{}},methods:{handleSearch(){this.getList({...this.searchForm})},clearSearchForm(e){this.$refs[e].resetFields(),this.searchForm={},this.handleSearch()}}};var v=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("el-form",{ref:"normalForm",attrs:{model:e.searchForm,inline:!0,size:"small"}},[e._l(e.tablesFilter,(function(n){return t("el-form-item",{key:n.prop,attrs:{prop:n.prop}},[t(e.componentsData[n.tag],e._g(e._b({tag:"component",attrs:{clearable:""},model:{value:e.searchForm[n.prop],callback:function(t){e.$set(e.searchForm,n.prop,t)},expression:"searchForm[item.prop]"}},"component",e.getBindAll(n),!1),e.getEventsAll(n)))],1)})),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),t("el-button",{on:{click:function(n){return e.clearSearchForm("normalForm")}}},[e._v("重置")])],1)],2),e._v(" "),[e._l(e.operations,(function(n,a){return[n.hide?e._e():t("el-button",e._b({key:a,attrs:{size:n.size||"mini",type:n.type||"info"},nativeOn:{click:function(e){return e.preventDefault(),n.call()}}},"el-button",e.getBtnBind(n),!1),[e._v(e._s(n.label))])]}))]],2)};v._withStripped=!0;const y={name:"NormalTable",components:{JsxRender:e,NoramlForm:s({render:v,staticRenderFns:[]},undefined,f,undefined,false,undefined,!1,void 0,void 0,void 0),NoramlTabs:h,Pagination:u},props:{tables:{type:Object,default:()=>{}}},data:()=>({datas:{list:[]},currentTab:"",filterValue:{},curPage:{},loading:!1}),computed:{onSearch(){return this.tables.onSearch},tableOperates:e=>(e,n)=>{const{btns:t}=e;return"function"==typeof t?t(n.row):t},jsxRender:e=>(e,n)=>"function"==typeof e?e(n):e,isTabs:e=>e=>!!e?.list,gather(){const{getList:e,tables:{filter:n,operations:t}}=this;return{getList:e,tablesFilter:n,operations:t}},getColumns:e=>e=>({...e,align:e.align||"center"}),isPageShow(){const{datas:e,tables:n}=this;return e?.list?.length>0&&!n.noPage},getPagesBind(){const{total:e=0,pageSize:n=10,currentPage:t=1}=this.datas??{};return{total:e,pageSize:n,currentPage:t}},getBtnBind:e=>e=>e?.bind??{}},mounted(){this.init()},activated(){this.init()},methods:{init(){const{isTabs:e,tables:n}=this;e(n.tabs)||this.getList()},async getList(e){e&&(this.filterValue=e,this.curPage.page=1);const{curPage:n,onSearch:t,currentTab:a}=this,i={filterValue:this.filterValue,currentTab:a,pagination:n};try{this.datas=await t(i)||[]}catch{console.error("onSearch出错了")}},confirmFn(e){return new Promise(((n,t)=>{this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{n()})).catch((()=>{t()}))}))},handleBtn(e,n){if(!n.confirm)return n.call(e);this.confirmFn(n.confirm).then((t=>n.call(e))).catch((e=>console.log("取消")))},changePage(e){this.curPage={...this.curPage,page:e},this.getList()},changeTabs(e){this.currentTab=e,this.getList()}}};var _=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[e.tables.columns?[e.isTabs(e.tables.tabs)?t("NoramlTabs",{attrs:{tabs:e.tables.tabs,"change-tabs":e.changeTabs}}):e._e(),e._v(" "),e.tables.filter?t("NoramlForm",e._b({},"NoramlForm",e.gather,!1)):e._e(),e._v(" "),t("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.datas.list,border:""}},"el-table",e.$attrs,!1),e.$listeners),[e._l(e.tables.columns,(function(n){return[n.render?t("el-table-column",{key:n.label,attrs:{label:n.label,width:n.width||"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("jsxRender",{attrs:{r:n.render,row:e.row}})]}}],null,!0)}):n.btns?t("el-table-column",{key:n.label,attrs:{label:n.label,fixed:n.fixed||!1,width:n.width||"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(e.tableOperates(n,a),(function(n,i){return[n.hide?e._e():t("el-button",e._b({key:i,staticClass:"normalButton",attrs:{size:n.size||"mini",type:n.type||"info"},nativeOn:{click:function(t){return t.preventDefault(),e.handleBtn(a.row,n)}}},"el-button",e.getBtnBind(n),!1),[e._v("\n                "+e._s(n.label)+"\n              ")])]}))]}}],null,!0)}):t("el-table-column",e._b({key:n.label},"el-table-column",e.getColumns(n),!1))]}))],2),e._v(" "),e.isPageShow?t("Pagination",e._b({on:{"current-change":e.changePage}},"Pagination",e.getPagesBind,!1)):e._e()]:e._e()],2)};_._withStripped=!0;const x={NormalTable:s({render:_,staticRenderFns:[]},(function(e){e&&e("data-v-e9ed6532_0",{source:"\n.normalButton[data-v-e9ed6532]{\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n",map:{version:3,sources:["/Users/yangbo/Desktop/yk/NormalTable/src/components/NormalTable/index.vue"],names:[],mappings:";AAiLA;EACA,eAAA;EACA,kBAAA;AACA",file:"index.vue",sourcesContent:['<template>\n  <div>\n    <template v-if="tables.columns">\n      <NoramlTabs v-if="isTabs(tables.tabs)" :tabs="tables.tabs" :change-tabs="changeTabs" />\n      \x3c!-- 筛选项 --\x3e\n      <NoramlForm v-if="tables.filter" v-bind="gather" />\n      \x3c!-- table --\x3e\n      <el-table\n        v-loading="loading"\n        :data="datas.list"\n        style="width: 100%; margin-top: 20px;"\n        border\n        v-bind="$attrs"\n        v-on="$listeners"\n      >\n        <template v-for="item in tables.columns">\n          \x3c!-- 是否有render --\x3e\n          <el-table-column v-if="item.render" :key="item.label" :label="item.label" :width="item.width || \'120px\'" align="center">\n            <template slot-scope="scope">\n              <jsxRender :r="item.render" :row="scope.row"/>\n            </template>\n          </el-table-column>\n          \x3c!-- 是否有btns--\x3e\n          <el-table-column v-else-if="item.btns" :key="item.label" :label="item.label" :fixed="item.fixed || false" :width="item.width || \'120px\'" align="center">\n            <template slot-scope="scope">\n              <template v-for="(btn,index) in tableOperates(item, scope)">\n                <el-button\n                  v-if="!btn.hide"\n                  :key="index"\n                  class="normalButton"\n                  :size="btn.size || \'mini\'"\n                  :type="btn.type || \'info\'"\n                  v-bind="getBtnBind(btn)"\n                  @click.native.prevent="handleBtn(scope.row, btn)"\n                >\n                  {{ btn.label }}\n                </el-button>\n              </template>\n            </template>\n          </el-table-column>\n          \x3c!-- 纯文本内容 --\x3e\n          <el-table-column v-else :key="item.label" v-bind="getColumns(item)" />\n        </template>\n      </el-table>\n      <Pagination v-if="isPageShow" v-bind="getPagesBind" @current-change="changePage" />\n    </template>\n  </div>\n</template>\n<script>\nimport Pagination from "./coms/pages.vue"\nimport { JsxRender } from "@/components/render"\nimport NoramlTabs from "./coms/tabs.vue"\nimport NoramlForm from "./coms/form.vue"\n\nexport default {\n  name: \'NormalTable\',\n  components: { JsxRender, NoramlForm, NoramlTabs, Pagination },\n  props: {\n    tables: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  data() {\n    return {\n      datas: {\n        list: []\n      },\n      currentTab: \'\',\n      filterValue: {},\n      curPage: {},\n      loading: false\n    }\n  },\n  computed: {\n    onSearch() {\n      return this.tables.onSearch\n    },\n    tableOperates: _ => (row, scope) => {\n      const { btns } = row\n      return typeof btns === \'function\' ? btns(scope.row) : btns\n    },\n    jsxRender: _ => (render, row) => {\n      return typeof render === \'function\' ? render(row) : render\n    },\n    isTabs: _ => tabs => !!tabs?.list,\n    gather() {\n      const { getList, tables: { filter, operations }} = this\n      return {\n        getList,\n        tablesFilter: filter,\n        operations\n      }\n    },\n    getColumns: _ => it => ({\n      ...it,\n      align: it.align || \'center\'\n    }),\n    isPageShow() {\n      const { datas, tables } = this\n      return datas?.list?.length > 0 && !tables.noPage\n    },\n    getPagesBind() {\n      const { total = 0, pageSize = 10, currentPage = 1 } = this.datas ?? {}\n      return {\n        total,\n        pageSize,\n        currentPage\n      }\n    },\n    getBtnBind: _ => btn => btn?.bind ?? {}\n  },\n  mounted() {\n    this.init()\n  },\n  activated() {\n    this.init()\n  },\n  methods: {\n    init() {\n      // 无tabs直接执行getlist\n      const { isTabs, tables } = this\n      if (!isTabs(tables.tabs)) {\n        this.getList()\n      }\n    },\n    async getList(filterValue) {\n      // filter数据发生改变页码重置为1\n      if (filterValue) {\n        this.filterValue = filterValue\n        this.curPage.page = 1\n      }\n      const { curPage, onSearch, currentTab } = this\n      const data = {\n        filterValue: this.filterValue, // 筛选\n        currentTab,\n        pagination: curPage // 页码\n      }\n      try {\n        this.datas = await onSearch(data) || []\n      } catch {\n        console.error(\'onSearch出错了\')\n      }\n    },\n    confirmFn(title) {\n      return new Promise((resove, reject) => {\n        this.$confirm(title, "提示", {\n          confirmButtonText: "确定",\n          cancelButtonText: "取消",\n          type: "warning"\n        }).then(() => {\n          resove()\n        }).catch(() => {\n          reject()\n        })\n      })\n    },\n    handleBtn(row, btn) {\n      if (!btn.confirm) return btn.call(row)\n      this.confirmFn(btn.confirm).then(r => btn.call(row))\n      .catch(r => console.log(\'取消\'))\n    },\n    changePage(page) {\n      this.curPage = {\n        ...this.curPage,\n        page\n      }\n      this.getList()\n    },\n    changeTabs(cur) {\n      this.currentTab = cur\n      this.getList()\n    }\n  }\n}\n<\/script>\n<style scoped>\n.normalButton{\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n</style>\n']},media:void 0})}),y,"data-v-e9ed6532",false,undefined,!1,l,void 0,void 0)},T=function(e){console.log(e.component,"install"),Object.keys(x).forEach((n=>{const t=x[n];e.component(t.name,t)}))};var w={Components:x,install:T};export{x as Components,w as default,T as install};
