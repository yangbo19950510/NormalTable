"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function t(t){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?e(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(exports,"__esModule",{value:!0});function a(e,t,n,a,r,i,o,s,l,c){"boolean"!=typeof o&&(l=s,s=o,o=!1);const d="function"==typeof n?n.options:n;let u;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,r&&(d.functional=!0)),a&&(d._scopeId=a),i?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},d._ssrRegister=u):t&&(u=o?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),u)if(d.functional){const e=d.render;d.render=function(t,n){return u.call(n),e(t,n)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,u):[u]}return n}const r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function i(e){return(e,t)=>function(e,t){const n=r?t.media||"default":e,a=s[n]||(s[n]={ids:new Set,styles:[]});if(!a.ids.has(e)){a.ids.add(e);let n=t.source;if(t.map&&(n+="\n/*# sourceURL="+t.map.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),a.element||(a.element=document.createElement("style"),a.element.type="text/css",t.media&&a.element.setAttribute("media",t.media),void 0===o&&(o=document.head||document.getElementsByTagName("head")[0]),o.appendChild(a.element)),"styleSheet"in a.element)a.styles.push(n),a.element.styleSheet.cssText=a.styles.filter(Boolean).join("\n");else{const e=a.ids.size-1,t=document.createTextNode(n),r=a.element.childNodes;r[e]&&a.element.removeChild(r[e]),r.length?a.element.insertBefore(t,r[e]):a.element.appendChild(t)}}}(e,t)}let o;const s={};const l={name:"NormalPages"};var c=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-pagination",e._g(e._b({staticClass:"pagination-container"},"el-pagination",e.$attrs,!1),e.$listeners))};c._withStripped=!0;const d=a({render:c,staticRenderFns:[]},(function(e){e&&e("data-v-61bd8561_0",{source:"\n.pagination-container[data-v-61bd8561] {\n  background: #fff;\n  margin-top: 16px;\n  text-align: right;\n}\n",map:{version:3,sources:["/Users/yangbo/Desktop/yk/NormalTable/src/components/NormalTable/coms/pages.vue"],names:[],mappings:";AAeA;EACA,gBAAA;EACA,gBAAA;EACA,iBAAA;AACA",file:"pages.vue",sourcesContent:['<template>\n  <el-pagination\n    class="pagination-container"\n    v-bind="$attrs"\n    v-on="$listeners"\n  >\n  </el-pagination>\n</template>\n\n<script>\nexport default {\n  name: \'NormalPages\'\n}\n<\/script>\n<style scoped>\n.pagination-container {\n  background: #fff;\n  margin-top: 16px;\n  text-align: right;\n}\n</style>\n']},media:void 0})}),l,"data-v-61bd8561",false,undefined,!1,i,void 0,void 0),u={name:"JsxRender",props:{r:{type:Function,default:()=>{}},row:{type:Object,default:()=>{}}},render(){const e=arguments[0],{r:t,row:n}=this;return e("div",[t(n)])}};const p={name:"NormalSelect",props:{tabs:{type:Object,default:()=>{}},changeTabs:{type:Function,default:()=>{}}},data:()=>({options:[],type:""}),mounted(){this.init()},methods:{async init(){var e;const{list:t,defaultValue:n}=this.tabs,a=t instanceof Function?await t():t,r=new Map([["value","value"],["id","id"]]),i=Object.keys(null==a?void 0:a[0]).find((e=>r.has(e))),o=null==a||null===(e=a[0])||void 0===e?void 0:e[i],s=n instanceof Function?await n(a):n;this.type=s||0===s?s:o,this.options=a,this.changeTab()},changeTab(){const{type:e,tabs:t,options:n}=this;if(t.changeTab){const a=(null==n?void 0:n.find((t=>t.id===e||t.value===e)))||{};t.changeTab(a)}this.changeTabs(e)}}};var m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tabs",{on:{"tab-click":e.changeTab},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.options,(function(e){return n("el-tab-pane",{key:e.id||e.value,attrs:{label:e.label,name:e.id||e.value}})})),1)};m._withStripped=!0;const b=a({render:m,staticRenderFns:[]},undefined,p,undefined,false,undefined,!1,void 0,void 0,void 0),f=["click","change","input","clear","clear","blur","focus"],h={Input:"el-input",Select:"NormalSelect",DatePicker:"NormalPicker",Date:"NormalDate",Cascader:"el-cascader",checkbox:"el-checkbox"};const g={name:"NormalSelect",props:["value","options","onchange"],data:()=>({newOptions:[]}),watch:{options:{handler(){this.init()},immediate:!0,deep:!0}},methods:{async init(){const{options:e=[]}=this,t=e instanceof Function;this.newOptions=t?await e():e},changeSelect(e){this.$emit("input",e)}}};var v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-select",e._g(e._b({attrs:{value:e.value,"collapse-tags":"",clearable:""},on:{change:e.changeSelect}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.newOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)};v._withStripped=!0;const y=a({render:v,staticRenderFns:[]},undefined,g,undefined,false,undefined,!1,void 0,void 0,void 0);const _={name:"DatePicker",props:{value:{type:[Array,String,Date],default:e=>e||""},defaultTime:{type:[Array,String],default:e=>e||["00:00:00","23:59:59"]},type:{type:String,default:"daterange"},valueFormat:{type:String,default:"yyyy-MM-dd"},startPlaceholder:{type:String,default:"开始日期"},endPlaceholder:{type:String,default:"结束日期"}},methods:{changeDate(e){this.$emit("input",e)}}};var w=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-date-picker",e._b({staticStyle:{width:"395px"},attrs:{value:e.value,"range-separator":"至","start-placeholder":e.startPlaceholder,"end-placeholder":e.endPlaceholder,"value-format":e.valueFormat,"default-time":e.defaultTime,type:e.type},on:{input:e.changeDate}},"el-date-picker",e.$attrs,!1))};w._withStripped=!0;const x=a({render:w,staticRenderFns:[]},undefined,_,undefined,false,undefined,!1,void 0,void 0,void 0);const S={name:"NormalDate",props:{value:{type:[Array,String,Date],default:e=>e||""},type:{type:String,default:"date"},valueFormat:{type:String,default:"yyyy-MM-dd"}},methods:{changeDate(e){this.$emit("input",e)}}};var P=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-date-picker",e._g(e._b({attrs:{value:e.value,type:e.type,"value-format":e.valueFormat},on:{input:e.changeDate}},"el-date-picker",e.$attrs,!1),e.$listeners))};P._withStripped=!0;const T={name:"NormalForm",components:{NormalSelect:y,NormalPicker:x,NormalDate:a({render:P,staticRenderFns:[]},undefined,S,undefined,false,undefined,!1,void 0,void 0,void 0)},props:{tablesFilter:{type:Array,default:()=>[]},operations:{type:Array,default:()=>[]},getList:{type:Function,default:()=>{}}},data:()=>({componentsData:h,searchForm:{}}),computed:{getBindAll:e=>e=>{const{options:n}=(null==e?void 0:e.bind)||{},a="function"==typeof n?null==n?void 0:n():n;return t(t({},a&&{options:a}),{},{placeholder:e.label},e.bind)},getEventsAll:e=>e=>{const t=(null==e?void 0:e.bind)||{},n={};return Object.keys(t).forEach((e=>{f.includes(e)&&(n[e]=t[e])})),n},getBtnBind:e=>e=>{var t;return null!==(t=null==e?void 0:e.bind)&&void 0!==t?t:{}}},methods:{handleSearch(){this.getList(t({},this.searchForm))},clearSearchForm(e){this.$refs[e].resetFields(),this.searchForm={},this.handleSearch()}}};var A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"normalForm",attrs:{model:e.searchForm,inline:!0,size:"small"}},[e._l(e.tablesFilter,(function(t){return n("el-form-item",{key:t.prop,attrs:{prop:t.prop}},[n(e.componentsData[t.tag],e._g(e._b({tag:"component",attrs:{clearable:""},model:{value:e.searchForm[t.prop],callback:function(n){e.$set(e.searchForm,t.prop,n)},expression:"searchForm[item.prop]"}},"component",e.getBindAll(t),!1),e.getEventsAll(t)))],1)})),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),n("el-button",{on:{click:function(t){return e.clearSearchForm("normalForm")}}},[e._v("重置")])],1)],2),e._v(" "),[e._l(e.operations,(function(t,a){return[t.hide?e._e():n("el-button",e._b({key:a,attrs:{size:t.size||"mini",type:t.type||"info"},nativeOn:{click:function(e){return e.preventDefault(),t.call()}}},"el-button",e.getBtnBind(t),!1),[e._v(e._s(t.label))])]}))]],2)};A._withStripped=!0;const F={name:"NormalTable",components:{JsxRender:u,NoramlForm:a({render:A,staticRenderFns:[]},undefined,T,undefined,false,undefined,!1,void 0,void 0,void 0),NoramlTabs:b,Pagination:d},props:{tables:{type:Object,default:()=>{}}},data:()=>({datas:{list:[]},currentTab:"",filterValue:{},curPage:{},loading:!1}),computed:{onSearch(){return this.tables.onSearch},tableOperates:e=>(e,t)=>{const{btns:n}=e;return"function"==typeof n?n(t.row):n},jsxRender:e=>(e,t)=>"function"==typeof e?e(t):e,isTabs:e=>e=>!(null==e||!e.list),gather(){const{getList:e,tables:{filter:t,operations:n}}=this;return{getList:e,tablesFilter:t,operations:n}},getColumns:e=>e=>t(t({},e),{},{align:e.align||"center"}),isPageShow(){var e;const{datas:t,tables:n}=this;return(null==t||null===(e=t.list)||void 0===e?void 0:e.length)>0&&!n.noPage},getPagesBind(){var e;const{total:t=0,pageSize:n=10,currentPage:a=1}=null!==(e=this.datas)&&void 0!==e?e:{};return{total:t,pageSize:n,currentPage:a}},getBtnBind:e=>e=>{var t;return null!==(t=null==e?void 0:e.bind)&&void 0!==t?t:{}}},mounted(){this.init()},activated(){this.init()},methods:{init(){const{isTabs:e,tables:t}=this;e(t.tabs)||this.getList()},async getList(e){e&&(this.filterValue=e,this.curPage.page=1);const{curPage:t,onSearch:n,currentTab:a}=this,r={filterValue:this.filterValue,currentTab:a,pagination:t};try{this.datas=await n(r)||[]}catch(e){console.error("onSearch出错了")}},confirmFn(e){return new Promise(((t,n)=>{this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t()})).catch((()=>{n()}))}))},handleBtn(e,t){if(!t.confirm)return t.call(e);this.confirmFn(t.confirm).then((n=>t.call(e))).catch((e=>console.log("取消")))},changePage(e){this.curPage=t(t({},this.curPage),{},{page:e}),this.getList()},changeTabs(e){this.currentTab=e,this.getList()}}};var k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.tables.columns?[e.isTabs(e.tables.tabs)?n("NoramlTabs",{attrs:{tabs:e.tables.tabs,"change-tabs":e.changeTabs}}):e._e(),e._v(" "),e.tables.filter?n("NoramlForm",e._b({},"NoramlForm",e.gather,!1)):e._e(),e._v(" "),n("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.datas.list,border:""}},"el-table",e.$attrs,!1),e.$listeners),[e._l(e.tables.columns,(function(t){return[t.render?n("el-table-column",{key:t.label,attrs:{label:t.label,width:t.width||"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("jsxRender",{attrs:{r:t.render,row:e.row}})]}}],null,!0)}):t.btns?n("el-table-column",{key:t.label,attrs:{label:t.label,fixed:t.fixed||!1,width:t.width||"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(e.tableOperates(t,a),(function(t,r){return[t.hide?e._e():n("el-button",e._b({key:r,staticClass:"normalButton",attrs:{size:t.size||"mini",type:t.type||"info"},nativeOn:{click:function(n){return n.preventDefault(),e.handleBtn(a.row,t)}}},"el-button",e.getBtnBind(t),!1),[e._v("\n                "+e._s(t.label)+"\n              ")])]}))]}}],null,!0)}):n("el-table-column",e._b({key:t.label},"el-table-column",e.getColumns(t),!1))]}))],2),e._v(" "),e.isPageShow?n("Pagination",e._b({on:{"current-change":e.changePage}},"Pagination",e.getPagesBind,!1)):e._e()]:e._e()],2)};k._withStripped=!0;const O={NormalTable:a({render:k,staticRenderFns:[]},(function(e){e&&e("data-v-e9ed6532_0",{source:"\n.normalButton[data-v-e9ed6532]{\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n",map:{version:3,sources:["/Users/yangbo/Desktop/yk/NormalTable/src/components/NormalTable/index.vue"],names:[],mappings:";AAiLA;EACA,eAAA;EACA,kBAAA;AACA",file:"index.vue",sourcesContent:['<template>\n  <div>\n    <template v-if="tables.columns">\n      <NoramlTabs v-if="isTabs(tables.tabs)" :tabs="tables.tabs" :change-tabs="changeTabs" />\n      \x3c!-- 筛选项 --\x3e\n      <NoramlForm v-if="tables.filter" v-bind="gather" />\n      \x3c!-- table --\x3e\n      <el-table\n        v-loading="loading"\n        :data="datas.list"\n        style="width: 100%; margin-top: 20px;"\n        border\n        v-bind="$attrs"\n        v-on="$listeners"\n      >\n        <template v-for="item in tables.columns">\n          \x3c!-- 是否有render --\x3e\n          <el-table-column v-if="item.render" :key="item.label" :label="item.label" :width="item.width || \'120px\'" align="center">\n            <template slot-scope="scope">\n              <jsxRender :r="item.render" :row="scope.row"/>\n            </template>\n          </el-table-column>\n          \x3c!-- 是否有btns--\x3e\n          <el-table-column v-else-if="item.btns" :key="item.label" :label="item.label" :fixed="item.fixed || false" :width="item.width || \'120px\'" align="center">\n            <template slot-scope="scope">\n              <template v-for="(btn,index) in tableOperates(item, scope)">\n                <el-button\n                  v-if="!btn.hide"\n                  :key="index"\n                  class="normalButton"\n                  :size="btn.size || \'mini\'"\n                  :type="btn.type || \'info\'"\n                  v-bind="getBtnBind(btn)"\n                  @click.native.prevent="handleBtn(scope.row, btn)"\n                >\n                  {{ btn.label }}\n                </el-button>\n              </template>\n            </template>\n          </el-table-column>\n          \x3c!-- 纯文本内容 --\x3e\n          <el-table-column v-else :key="item.label" v-bind="getColumns(item)" />\n        </template>\n      </el-table>\n      <Pagination v-if="isPageShow" v-bind="getPagesBind" @current-change="changePage" />\n    </template>\n  </div>\n</template>\n<script>\nimport Pagination from "./coms/pages.vue"\nimport { JsxRender } from "@/components/render"\nimport NoramlTabs from "./coms/tabs.vue"\nimport NoramlForm from "./coms/form.vue"\n\nexport default {\n  name: \'NormalTable\',\n  components: { JsxRender, NoramlForm, NoramlTabs, Pagination },\n  props: {\n    tables: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  data() {\n    return {\n      datas: {\n        list: []\n      },\n      currentTab: \'\',\n      filterValue: {},\n      curPage: {},\n      loading: false\n    }\n  },\n  computed: {\n    onSearch() {\n      return this.tables.onSearch\n    },\n    tableOperates: _ => (row, scope) => {\n      const { btns } = row\n      return typeof btns === \'function\' ? btns(scope.row) : btns\n    },\n    jsxRender: _ => (render, row) => {\n      return typeof render === \'function\' ? render(row) : render\n    },\n    isTabs: _ => tabs => !!tabs?.list,\n    gather() {\n      const { getList, tables: { filter, operations }} = this\n      return {\n        getList,\n        tablesFilter: filter,\n        operations\n      }\n    },\n    getColumns: _ => it => ({\n      ...it,\n      align: it.align || \'center\'\n    }),\n    isPageShow() {\n      const { datas, tables } = this\n      return datas?.list?.length > 0 && !tables.noPage\n    },\n    getPagesBind() {\n      const { total = 0, pageSize = 10, currentPage = 1 } = this.datas ?? {}\n      return {\n        total,\n        pageSize,\n        currentPage\n      }\n    },\n    getBtnBind: _ => btn => btn?.bind ?? {}\n  },\n  mounted() {\n    this.init()\n  },\n  activated() {\n    this.init()\n  },\n  methods: {\n    init() {\n      // 无tabs直接执行getlist\n      const { isTabs, tables } = this\n      if (!isTabs(tables.tabs)) {\n        this.getList()\n      }\n    },\n    async getList(filterValue) {\n      // filter数据发生改变页码重置为1\n      if (filterValue) {\n        this.filterValue = filterValue\n        this.curPage.page = 1\n      }\n      const { curPage, onSearch, currentTab } = this\n      const data = {\n        filterValue: this.filterValue, // 筛选\n        currentTab,\n        pagination: curPage // 页码\n      }\n      try {\n        this.datas = await onSearch(data) || []\n      } catch {\n        console.error(\'onSearch出错了\')\n      }\n    },\n    confirmFn(title) {\n      return new Promise((resove, reject) => {\n        this.$confirm(title, "提示", {\n          confirmButtonText: "确定",\n          cancelButtonText: "取消",\n          type: "warning"\n        }).then(() => {\n          resove()\n        }).catch(() => {\n          reject()\n        })\n      })\n    },\n    handleBtn(row, btn) {\n      if (!btn.confirm) return btn.call(row)\n      this.confirmFn(btn.confirm).then(r => btn.call(row))\n      .catch(r => console.log(\'取消\'))\n    },\n    changePage(page) {\n      this.curPage = {\n        ...this.curPage,\n        page\n      }\n      this.getList()\n    },\n    changeTabs(cur) {\n      this.currentTab = cur\n      this.getList()\n    }\n  }\n}\n<\/script>\n<style scoped>\n.normalButton{\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n</style>\n']},media:void 0})}),F,"data-v-e9ed6532",false,undefined,!1,i,void 0,void 0)},B=function(e){console.log(e.component,"install"),Object.keys(O).forEach((t=>{const n=O[t];e.component(n.name,n)}))};var N={Components:O,install:B};exports.Components=O,exports.default=N,exports.install=B;
